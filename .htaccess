# Apache redirection rules for Usable Landing Page
# Redirect all non-root routes to the root index.html

RewriteEngine On

# Allow access to assets, scripts, styles directories
RewriteRule ^(assets|scripts|styles)/.*$ - [L]

# Allow common files
RewriteRule ^(robots\.txt|sitemap\.xml|favicon\.ico|CNAME|README\.md|TROUBLESHOOTING\.md)$ - [L]

# Clean URLs - serve .html files without extension
# Handle nested paths (e.g., /blog/why-were-embracing-the-usable-brand)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !\.(html|css|js|png|jpg|jpeg|gif|svg|ico|xml|txt)$ [NC]
RewriteCond %{REQUEST_URI} ^/([^/]+)/([^/]+)/?$
RewriteCond %{DOCUMENT_ROOT}/%1/%2.html -f
RewriteRule ^([^/]+)/([^/]+)/?$ /$1/$2.html [L]

# Handle single-level paths (e.g., /blog, /news)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !\.(html|css|js|png|jpg|jpeg|gif|svg|ico|xml|txt)$ [NC]
RewriteCond %{REQUEST_URI} ^/([^/]+)/?$
RewriteCond %{DOCUMENT_ROOT}/%1.html -f
RewriteRule ^([^/]+)/?$ /$1.html [L]

# Redirect all other routes to root, preserving query string and fragment
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/$
RewriteCond %{REQUEST_URI} !^/index\.html$
RewriteRule ^.*$ /index.html [R=301,L,QSA]
